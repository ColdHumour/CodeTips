EXCEL TIPS
==========

## 函数

- 返回元素在序列中的位置，当不需要VLOOKUP时用来查行号或者列号很有用

        =MATCH(A1, B1:B10, 0)

- 根据地址相对位置取值，只要有行列偏移量即可，注意计数从0开始

        =OFFSET(A1, 1, 1)  # 等同于 =B2
        =OFFSET(A1, 0, 0)  # 等同于 =A1

- 根据单元格地址字符串取值，其中地址可以用其他公式生成，然后整体可以嵌套在其他用于计算的函数内

        =INDIRECT("A1")  # 等同于 =A1
        =INDIRECT("Sheet1!A1:B10")

- 字符串转日期，如20170101这种，其他情况可以此类推

        =DATE(LEFT(A1, 4), MID(A1, 5, 2), RIGHT(A1, 2))
        =DATEVALUE(A1)

- 日期转字符串，如2017-01-01，其他情况可以此类推

        =TEXT(A1, "yyyy-mm-dd")

- 字符串双引号

        ="A""B"  # 输出即 A"B

- 第N大的数

        =LARGE(A1:A30, 2)  # 第2大

- 序列公式，即某些函数输入可以是 Range 而非单个的值，按 `Ctrl + Shift + Enter` 执行，执行后公式最外侧会显示 `{}`。此功能配合 SUBTOTAL 等逆天函数可以实现在一个单元格中计算股票一段时间的波动率乃至最大回撤：

        =STDEV.S(A3:A100/A2:A99)*SQRT(245)  # 波动率
        =MIN(A2:A100/SUBTOTAL(4,OFFSET(A2:A100,ROW(A2:A100)-ROW(A2:A100),0,ROW(A2:A100)-ROW(INDIRECT(A2))+1)))-1  # 最大回撤

- 对字符串形式存在的公式求值，需要在 `公式-名称管理器` 中调用 EVALUATE 函数

- `公式-名称管理器` 可以用于定义常量，或者一个需要被反复调用的引用，似乎只需要 eval 一次即可

- `公式-名称管理器` 名称管理器也可以用于定义需要大量反复使用的函数，固定部分参数，相当于 Python 里的 partial

---



## 更改默认设置

主要是字体和字号，由于 Excel 新建文件和新建 sheet 的机制不一样，因此需要修改多个地方。

- 文件 - 选项 - 常规 - 新建工作簿时 - 修改字体和字号到想要的样子

- 开始 - 样式 - 单元格样式 - 常规（右键 - 修改） - 修改字体和字号到想要的样子，保存

- `Win + R` 输入 `regedit` 打开注册表编辑器，查看 `HKEY_CLASSES_ROOT\.xlsx\Excel.Sheet.12\ShellNew` 项中的 `FileName` 的值，如果找不到的话可以试试 `C:\Windows\SHELLNEW`

- 打开该文件，`Ctrl + A`，把字体和字号设置成想要的样子，保存

- 如果无法保存，则先复制一份到其他路径下改好，原路径中的文件 `Shift + 右键` 删除，然后把改好的文件重新复制到当前路径下

---



## 加密

另存为 - “保存”按钮左边的“工具”下拉选“常规选项”，然后可以分别设置文件打开的密码和修改的密码

